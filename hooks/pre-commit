#!/usr/bin/env bash

set -eu
echo "Pre-commit hook"

unformatted=$(cargo fmt --check --message-format short | ag -v generated_states || exit 0)

if [ ! -z "$unformatted" ]; then
	echo "Unformatted files!"
	echo "$unformatted"
	exit 1
fi

# also build test-app and it's generated_states modules
cargo build --all

# test until first error
just test-fast
