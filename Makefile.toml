[tasks.run]
command = "cargo"
args = ["run"]

[tasks.run-headless]
command = "cargo"
args = ["run"]

[tasks.test]
install_crate = "cargo-insta"
command = "cargo"
args = ["insta", "test", "--unreferenced=warn"]

[tasks.review]
install_crate = "cargo-insta"
command = "cargo"
# do not use nextest for snapshot test+review, it breaks something
args = ["insta", "review"]

[tasks.cover]
install_crate = "cargo-llvm-cov"
command = "cargo"
args = ["llvm-cov", "nextest"]

[tasks.generate-report]
install_crate = "cargo-llvm-cov"
command = "cargo"
args = ["llvm-cov", "nextest", "--doctests", "--html"]

[tasks.format-report]
command = "npx"
args = ["-y", "prettier", "--write", "target/llvm-cov/html"]
ignore_errors = true

[tasks.copy-report]
command = "cp"
args = ["-r", "target/llvm-cov/html", ".report"]

[tasks.replace-report]
command = "mv"
args = ["-f", ".report", "report"]

[tasks.report]
run_task = [
    { name = [
        "generate-report",
        "format-report",
        "copy-report",
        "replace-report",
    ] },
]
